name: nightly-benchmark
# Runner versions pinned; see ci.yaml header comment for rationale.

on:
  schedule:
    # Run at 4:17 UTC every day (off-peak minute)
    - cron: '17 4 * * *'
  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  benchmark:
    runs-on: ubuntu-24.04
    steps:
    - name: ðŸ“‚ Checkout code
      uses: actions/checkout@v6

    - name: ðŸ’° Cargo cache
      uses: Swatinem/rust-cache@v2

    - name: ðŸ’° Rust repo cache
      uses: actions/cache@v5
      with:
        path: target/bench-repos
        key: bench-repos-rust-${{ runner.os }}

    - name: ðŸ“Š Run all benchmarks
      run: cargo bench --bench list

    - name: ðŸ“¦ Upload benchmark results
      uses: actions/upload-artifact@v6
      with:
        name: benchmark-results-${{ github.run_id }}
        path: target/criterion
