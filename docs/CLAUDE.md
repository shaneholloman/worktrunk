# Docs Site

This is the Zola-based documentation site for Worktrunk, published at worktrunk.dev.

## Development workflow

Start the dev server from the docs directory:

```bash
cd docs && zola serve  # Runs on http://127.0.0.1:1111
```

### Verifying changes

**Text-only changes** (prose edits, content rewrites): Run pre-commit and provide the dev server link. Playwright verification is not required.

**Visual changes** (CSS, layout, templates, responsive breakpoints): Use Playwright MCP to verify before returning. Visual bugs often hide in CSS specificity, template inheritance, and responsive behavior.

Playwright workflow for visual changes:
1. Navigate to affected page(s)
2. Take a snapshot to verify rendered output
3. Iterate if the result doesn't match expectations

Common visual issues to check:
- Text positioning and visibility
- Spacing and alignment
- Regressions on nearby elements
- Responsive behavior (use `browser_resize`)

**Always include the dev server link** when returning after doc changes:

```
View changes: http://127.0.0.1:1111
```

## Theme architecture

The docs use a "warm workbench" theme built on top of the Juice Zola theme. Key files:

| File | Purpose |
|------|---------|
| `templates/_variables.html` | CSS custom properties (colors, layout, typography) |
| `sass/custom.scss` | All styling, organized by section |
| `templates/base.html` | Head overrides, iOS viewport polyfill |
| `templates/index.html` | Homepage hero and animations |
| `templates/page.html` | Doc page TOC rendering |

### Layout system

The sticky header and TOC use **definitional CSS variables** so positions are always in sync:

```
--wt-header-height: 60px    (includes border via box-sizing: border-box)
--wt-main-padding-top: 40px

TOC sticks at: calc(header + padding) = 100px
Anchor scroll-margin: same calculation
```

When either variable changes (including via media queries), all dependent values update automatically. This prevents the TOC from "jumping" when transitioning to sticky mode.

### Key technical decisions

1. **`box-sizing: border-box` on header** - Border is included in height, simplifying calculations
2. **`scrollbar-gutter: stable`** - Reserves scrollbar space to prevent layout shift on navigation
3. **IntersectionObserver intercept** - Disables Juice's scroll-spy which conflicts with our TOC styling
4. **Logo preload** - Prevents flash when navigating between pages
5. **WCAG AA colors** - `--wt-color-text-soft` is #78716a for 4.5:1 contrast
6. **iOS viewport polyfill** - Sets stable `--vh-full` variable for Firefox iOS/Chrome iOS (see `templates/base.html` for details on the jank issue and what we tried)

### Responsive breakpoints

Variables are overridden in media queries to maintain definitional correctness:

- **≤1024px**: `--wt-main-padding-top: 30px`
- **≤768px**: `--wt-header-height: 50px`, `--wt-main-padding-top: 20px`, TOC hidden

### Extending the theme

When adding new positioned elements:
- Use the layout variables rather than hardcoding pixel values
- Test anchor navigation to verify no visual jumps
- Check both with and without page scroll

## Command documentation

Command pages (e.g., `switch.md`, `merge.md`, `list.md`) are **generated from the CLI source code**. The **entire file** is generated — manual edits will be overwritten.

### Generation mechanism

Each command page is generated by running:

```bash
wt <command> --help-page > docs/content/<command>.md
```

The output combines:
1. **Zola frontmatter** — title, weight, group metadata
2. **Conceptual documentation** — from `after_long_help` in `src/cli.rs`
3. **Command Reference section** — the standard `--help` output

### Editing command docs

**To update command documentation, edit `src/cli.rs`**, not the markdown files directly.

- **Conceptual content** — Edit the `after_long_help` attribute on the command
- **Usage/options/examples** — Edit the clap attributes (`about`, `long_about`, doc comments on args)

After editing, run the sync test (which auto-updates out-of-sync pages):

```bash
cargo test --test integration test_command_pages_are_in_sync
```

### Example output expansion (wt list)

The `wt list` examples use **HTML comments + code blocks** that expand to full snapshot output. In `cli.rs`, you write:

```
<!-- wt list -->
```console
$ wt list
```
```

This renders differently in each context:
- **Terminal help (`--help`)**: HTML comment skipped, code block shows as dimmed `$ wt list`
- **Web docs (`--help-page`)**: Both are replaced with the standard template format:

```
<!-- ⚠️ AUTO-GENERATED from tests/snapshots/<snapshot_file> — edit source to update -->

{% terminal() %}
<span class="prompt">$</span> <span class="cmd">wt list</span>
<output...>
{% end %}

<!-- END AUTO-GENERATED -->
```

**The mapping** (in `tests/integration_tests/readme_sync.rs`):

| Placeholder | Snapshot File |
|-------------|---------------|
| `<!-- wt list -->` | `readme_example_list.snap` |
| `<!-- wt list --full -->` | `readme_example_list_full.snap` |
| `<!-- wt list --branches --full -->` | `readme_example_list_branches.snap` |

**To update example output:**

1. Edit test setup in `tests/integration_tests/list.rs` → `setup_readme_example_repo()`
2. Run tests to regenerate snapshots: `cargo test --test integration readme_example_list`
3. Accept snapshots: `cargo insta accept`
4. Sync docs: `cargo test --test integration test_command_pages_are_in_sync`

The examples in `cli.rs` are just command stubs — the actual output comes from snapshots generated by integration tests. This ensures docs always match real CLI behavior.

### CLI and web compatibility

Content in `after_long_help` must work in **both** the terminal (`--help`) and the web docs:

- **Tables** — Work in both. Prefer tables over bullet lists for structured data.
- **Markdown links** — Work in both (`[text](/path/)`)
- **Code blocks** — Work in both
- **Raw HTML** — Avoid. Renders as raw text in terminal help.

### Post-processing for web docs

The `--help-page` generator in `src/main.rs` applies post-processing to transform CLI-friendly content into web-friendly HTML:

| CLI Source | Web Output |
|------------|------------|
| `` ```console `` | `` ```bash `` |
| `` `●` green `` | `<span style='color:#0a0'>●</span> green` |
| `` `●` blue `` | `<span style='color:#00a'>●</span> blue` |
| `` `●` red `` | `<span style='color:#a00'>●</span> red` |
| `` `●` yellow `` | `<span style='color:#a60'>●</span> yellow` |
| `` `●` gray `` | `<span style='color:#888'>●</span> gray` |

To add web-only styling for new content, edit `colorize_ci_status_for_html()` in `src/main.rs` — not the markdown files.

Similarly, `md_help::colorize_status_symbols()` applies ANSI colors for terminal `--help` output.

The generated files contain this warning comment in the Command Reference section:
```html
<!-- ⚠️ AUTO-GENERATED from `wt <command> --help-page` — edit cli.rs to update -->
```

## Demo GIF workflow

Demo GIFs (~2MB each) are stored in a separate `worktrunk-assets` repo to avoid bloating git history.

**For local development:**
```bash
./scripts/fetch-assets      # Download to docs/static/assets/ (gitignored)
```

**To update demos:**
```bash
./demos/wt-demo/build       # Build from VHS tape file
./demos/wt-select/build     # Build select demo
./scripts/publish-assets    # Push to assets repo
```

Deploy runs `fetch-assets` before building.
