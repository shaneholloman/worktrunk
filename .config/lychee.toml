# Lychee link checker configuration
# See: https://lychee.cli.rs/

# Network resilience - handles transient failures
max_retries = 5
timeout = 20
max_redirects = 5

# Accepted HTTP status codes
accept = [200, 206, 429]

# Caching to reduce rate limiting and improve performance
cache = true
max_cache_age = "1d"
cache_exclude_status = "400..=599"  # Don't cache errors (only successes)

# Exclude sites that block GitHub Actions or have reliability issues
exclude = [
    # Zola internal links use @/ syntax (validated by `zola check`, not lychee)
    "/@/",

    # Private or authenticated GitHub resources
    "github\\.com/anthropics/claude-code/issues",

    # Social media (blocks GitHub Actions)
    "twitter\\.com",
    "x\\.com",
    "reddit\\.com",
    "linkedin\\.com",

    # Sites with bot protection
    "anthropic\\.com/engineering",

    # Sites with reliability issues in CI
    "stackoverflow\\.com",
    "npmjs\\.com",

    # Package registries (frequently return 429 or block CI)
    "crates\\.io",
    "docs\\.rs",
    "img\\.shields\\.io",

    # Sites already excluded in markdown-link-check
    "opensource\\.org",
    "llm\\.datasette\\.io",

    # Asset GIFs stored in separate worktrunk-assets repo (gitignored, fetched at deploy)
    # Pattern for file:// URLs and root-relative paths
    "file://.*wt-.*\\.gif",
    "/assets/wt-.*\\.gif",

    # Local build artifacts (not checked into git)
    "wt-demo/out/wt-demo\\.gif",

    # Local dev server URLs (not running during CI)
    "127\\.0\\.0\\.1",
    "localhost",

    # TODO: Remove after first deployment - new page from hooks.md â†’ hook.md consolidation
    "https://worktrunk\\.dev/hook/",
]


# Exclude source files from link checking
exclude_path = [
    ".claude-plugin/skills/worktrunk/reference/README.md",
    # Files with root-relative asset paths that lychee can't resolve
    # (assets are fetched at deploy time from worktrunk-assets repo)
    "docs/content/merge.md",
    "docs/content/select.md",
    "docs/content/why-worktrunk.md",
    "docs/content/worktrunk.md",
    # README references assets that may not be published yet
    "README.md",
]
